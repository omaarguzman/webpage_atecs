services:
  php-apache:
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      - "8080:80" # Laravel
      - "5173:5173" # Vite
    volumes:
      - ./src:/var/www/html # Comparte la carpeta src con el contenedor
    command: sh -c "chown -R www-data:www-data /var/www/html/public /var/www/html/storage && chmod -R 755 /var/www/html/public /var/www/html/storage && npm install && npm run dev & apache2-foreground"
    container_name: webBlog-app

  mysql:
    image: mysql:8.0
    container_name: webBlog-mysql
    ports:
      - "3306:3306"
    environment:
      MYSQL_ROOT_PASSWORD: root
      MYSQL_DATABASE: web
      MYSQL_USER: carlos
      MYSQL_PASSWORD: admin1
    volumes:
      - mysql-data:/var/lib/mysql

  # node:
  #   image: node:18
  #   working_dir: /var/www/html
  #   volumes:
  #     - ./src:/var/www/html
  #   command: ["npm", "install"]

  # node-watch:
  #   image: node:18
  #   working_dir: /var/www/html
  #   volumes:
  #     - ./src:/var/www/html
  #   command: ["npm", "run", "dev"]

volumes:
  mysql-data:
